# integration ideas

Проект собирает идеи для интеграции данных с мастер системы. В будущем планируется создание универсального решения.
Сюда включены идеи для интеграции данных для обчных моделей и моделей - страниц wagtail

### Основная идея:

1. Модель сырых данных (RawIntegrationData) заполняется сообщениями из мастер системы, а именно список объектов интеграции
2. Разбиваем сообщение на 'Экземпляры объектов интеграции' IntegrationInstance
3. Обрабатываем каждый экземпляр
4. Обновляем статус модели RawIntegrationData по следующей логике:
- Все сообщения обработаны успешно => статус Обработано
- Хотябы одно сообщение обработано с ошибкой => статус Обработано с ошибкой


### RawIntegrationData. Статусы
- Сообщение МС получено (0)
- Сообщение МС получено -> Сообщение МС получено. Сообщение корректно (1)
- Сообщение МС получено -> Сообщение MC получено. Сообщение не корректно (-1)
- Сообщение МС получено. Сообщение корректно -> Сообщение разбито по объектам (2)
- Сообщение МС получено. Сообщение корректно -> Ошибка разбиения по объектам (-2)
- Ошибка разбиения по объектам  -> Сообщение разбито по объектам
- Сообщение разбито по объектам -> Обработано (3)
- Сообщение разбито по объектам -> Обработано с ошибками (-3)


### IntegrationInstance. Статусы
- В ожидании обработки (0)
- В ожидании обработки -> В процессе обработки (1)
- В процессе обработки -> Ошибка обработки (-2)
- В процессе обработки -> Обработано (2)


#### RawIntegrationData заполняется посредством API
1. получает json
2. записывает в базу данных RawIntegrationData
3. проверяет схему пришедших данных
4. если корректно запускает асинхронную задачу (1) (далее тексту)
5. отправляет ответ (успешный или нет в зависимости от пункта 3)

#### Отстальные процессы производятся с помощью асинхронных задач celery
1. Асинхронная задача разбиения сообщения (сырых данных) на экземпляры объектов интеграции
2. Асинхронная задача обработки экземпляров объектов интеграции
3. Асинхронная задача повторной обработки экземпляров объектов интеграции 
4. Асинхронная задача проверки статусов всех экземпляров объектов интеграции в рамках одного сообщения

* Асинхронные задачи запускаются переодически или по клику (необходима настройка в вашем проекте)
